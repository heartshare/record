# 服务器维护常见问题

* [linux服务器定时执行任务](#linux服务器定时执行任务)
* [高性能系统](#高性能系统)
* [正向代理与反向代理](#正向代理与反向代理)
* [获取一个进程的内存并监控](#获取一个进程的内存并监控)

---

### linux服务器定时执行任务

1. 参考链接：

    [Centos7 利用crontab定时执行任务及配置方法](https://www.cnblogs.com/p0st/p/9482167.html)

    [CentOs 7.0实现定时任务（定时访问网页）](https://blog.csdn.net/qq_16505093/article/details/51478064)

2. 详解：

    crond 和 crontab
    ```txt
    1、crontab -e，进入编辑界面 
    2、输入/2 * * * * curl http://www.baidu.com，表示每两分钟访问一次网页 
    3、保存退出，然后service crond start启动服务 
    4、chkconfig crond on设置开机自启动 
    5、 
    基本格式 : 
    *　　*　　*　　*　　*　　command 
    分　 时　 日　 月　 周　 命令 
    第1列表示分钟1～59 每分钟用或者 /1表示 
    第2列表示小时1～23（0表示0点） 
    第3列表示日期1～31 
    第4列表示月份1～12 
    第5列标识号星期0～6（0表示星期天）
    crond不支持精确到秒
    ```

### 高性能系统

1. 参考链接：

    * [高性能系统的常用开发手段](https://www.jianshu.com/p/b47e11b243ed)
    * [《解密腾讯海量服务之道》讲座笔记](https://www.cnblogs.com/xingzc/p/9023289.html)
    * [【TCP/IP】流量控制和拥塞控制](https://blog.csdn.net/bible_reader/article/details/90514729)

2. 详解：

    * 高性能方法

        1. 服务器硬件能力(但有瓶颈)
        2. 缓存(服务器缓存、浏览器缓存)(但不适用于提升并发量)
        3. 消息队列(解耦+削峰+异步)
        4. 负载均衡
        5. 数据库分库(读写分离)、分表(水平分表、垂直分表)
        6. CDN 加速(图片、视频)
        7. 合适的数据库连接池、线程池
        8. 多线程

    * 容灾方法

        1. 光纤断/机房停电-分布式部署
        2. 服务器硬件故障死机-数据热备份
        3. 程序崩溃-自动拉起(重启)
        4. 高并发崩溃-负载均衡、流量拥塞控制(参考链接3)、频率控制
        5. 系统指标异常-监控报警(流量、进程、cpu、IO、丢包、延时等)
        6. 不可预知的程序bug-灰度发布

    * 海量服务优化建议

        1. 大系统分布式解耦(微服务)
        2. 先运行正常再优化
        3. 架构重构




### 正向代理与反向代理

1. 参考链接：

    * [反向代理和正向代理区别](https://www.cnblogs.com/taostaryu/p/10547132.html)

2. 详解：

    * 正向代理

        * 场景

            翻墙,卖票的黄牛

        * 描述

            正向代理客户端。

            国内访问谷歌，直接访问访问不到，我们可以通过一个正向代理服务器，请求发到代理服，代理服务器能够访问谷歌，这样由代理去谷歌取到返回数据，再返回给我们，这样我们就能访问谷歌了。

        * 用途

            1. 访问原来无法访问的资源，如google
            2. 可以做缓存，加速访问资源
            3. 对客户端访问授权，上网进行认证
            4. 代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息

    * 反向代理

        * 场景

            代理转发给各服务器，负载均衡

        * 描述

            反向代理服务端。

            代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器

        * 用途

            1. 保证内网的安全，阻止web攻击，大型网站，通常将反向代理作为公网访问地址，Web服务器是内网
            2. 负载均衡，通过反向代理服务器来优化网站的负载

### 获取一个进程的内存并监控

1. 参考链接：

    * [几个常见面试题，工作中也经常用到](https://mp.weixin.qq.com/s/IvWGkm5pn3vjbLUB-SvXkQ)

2. 详解

    * ps 可以获知一个进程所占用的内存

        ps -O rss -p 3506

    * pidstat 查看进程状态(linux)

        pidstat -r -p 3506 1

    * top/htop 查看进程状态(mac)

        htop -p 31796